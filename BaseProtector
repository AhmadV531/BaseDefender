-- Base Protector V3 - PREMIUM SMOOTH BLACK & WHITE EDITION
-- Place in StarterPlayer > StarterPlayerScripts (LocalScript)
-- NOW WITH INDEXED REMOTE DETECTION

if not game:IsLoaded() then
    game.Loaded:Wait()
end

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Stats = game:GetService("Stats")

local LocalPlayer = Players.LocalPlayer
while not LocalPlayer do
    task.wait()
    LocalPlayer = Players.LocalPlayer
end

-- Find Admin Remote - INDEXED DETECTION METHOD
local adminRemote = nil
local notificationRemote = nil

task.spawn(function()

    
    local Packages = ReplicatedStorage:WaitForChild("Packages", 10)
    if not Packages then
        warn("‚ùå Packages folder not found!")
        return
    end
    
    local Net = Packages:WaitForChild("Net", 10)
    if not Net then
        warn("‚ùå Net folder not found!")
        return
    end
    

    local children = Net:GetChildren()
    
    -- Build the mapping: each remote points to the next one
    local remoteMap = {}
    for i, obj in ipairs(children) do
        if obj:IsA("RemoteEvent") then
            local nextIndex = i + 1
            local nextObj = children[nextIndex]
            if nextObj and nextObj:IsA("RemoteEvent") then
                remoteMap[obj] = nextObj

            end
        end
    end
    

    -- Find which remote POINTS TO DealWithThis
    for remote, nextRemote in pairs(remoteMap) do
        if nextRemote.Name == "RE/AdminPanelService/DealWithThis" then
            adminRemote = remote
            break
        end
    end
    

    -- Find what NotificationService/Notify POINTS TO (the next remote)
    for remote, nextRemote in pairs(remoteMap) do
        if remote.Name:match("NotificationService") or remote.Name:match("Notify") then
            notificationRemote = nextRemote
            break
        end
    end
    
    if not notificationRemote then
        warn("‚ö†Ô∏è Notification remote not found - will use GUI fallback method")
    end
    
    if adminRemote then

    else
        warn("‚ùå Base Protector failed - admin remote not found")
    end
end)

-- Settings
local spamKickEnabled = false
local spamNoKickEnabled = true -- ALWAYS ON
local antiTPEnabled = false
local punishedPlayers = {}
local antiTPCooldowns = {}

local priorityCommands = {"rocket"}
local secondaryCommands = {"inverse", "tiny", "morph", "jumpscare"}

-- Helper Functions
local function sendCommand(command, targetPlayer)
    if not adminRemote then 
        warn("‚ö†Ô∏è Cannot send command - admin remote not found")
        return 
    end
    
    -- Send immediately for fastest execution
    pcall(function()
        adminRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", targetPlayer, command)
    end)
end

function findMyPlot()
    local plotsFolder = workspace:FindFirstChild("Plots")
    if not plotsFolder then return nil end
    
    for _, plot in pairs(plotsFolder:GetChildren()) do
        local plotSign = plot:FindFirstChild("PlotSign")
        if plotSign then
            local yourBase = plotSign:FindFirstChild("YourBase")
            if yourBase and yourBase:IsA("BillboardGui") and yourBase.Enabled == true then
                return plot
            end
        end
    end
    
    local playerName = LocalPlayer.Name
    for _, plot in pairs(plotsFolder:GetChildren()) do
        if string.find(plot.Name, playerName) then return plot end
        local owner = plot:FindFirstChild("Owner")
        if owner and owner.Value == LocalPlayer then return plot end
    end
    
    local character = LocalPlayer.Character
    if character then
        local hrp = character:FindFirstChild("HumanoidRootPart")
        if hrp then
            for _, plot in pairs(plotsFolder:GetChildren()) do
                local plotPart = plot:FindFirstChild("PlotPart") or plot:FindFirstChild("Base")
                if plotPart and plotPart:IsA("BasePart") then
                    if (hrp.Position - plotPart.Position).Magnitude < 100 then
                        return plot
                    end
                end
            end
        end
    end
    return nil
end

local function getPlayersInMyPlot()
    local myPlot = findMyPlot()
    if not myPlot then return {} end
    
    local playersInPlot = {}
    local plotPosition = myPlot:GetPivot().Position
    
    local decorations = myPlot:FindFirstChild("Decorations")
    if decorations and decorations:FindFirstChild("Model") then
        plotPosition = decorations.Model:GetPivot().Position
    end
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local hrp = player.Character:FindFirstChild("HumanoidRootPart")
            if hrp and (hrp.Position - plotPosition).Magnitude < 120 then
                table.insert(playersInPlot, player)
            end
        end
    end
    return playersInPlot
end

local function executeAPSpam(targetUsername, shouldKick)
    if not targetUsername or targetUsername == "" then return end
    
    local targetPlayer = nil
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Name == targetUsername then
            targetPlayer = player
            break
        end
    end
    if not targetPlayer then return end
    
    -- Send ALL commands instantly with no delays
    sendCommand("balloon", targetPlayer)
    for _, cmd in ipairs(priorityCommands) do
        sendCommand(cmd, targetPlayer)
    end
    for _, cmd in ipairs(secondaryCommands) do
        sendCommand(cmd, targetPlayer)
    end
    
    if shouldKick then
        task.wait(0.1)
        LocalPlayer:Kick("Saved by Base Protector")
    end
end

local function executeDefense(targetPlayerName, shouldKick)

    
    if (shouldKick and not spamKickEnabled) or (not shouldKick and not spamNoKickEnabled) then 

        return 
    end
    
    if punishedPlayers[targetPlayerName] then 

        return 
    end
    
    punishedPlayers[targetPlayerName] = true

    
    local targetPlayer = nil
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Name == targetPlayerName then
            targetPlayer = player
            break
        end
    end
    if not targetPlayer then 

        return 
    end
    
    executeAPSpam(targetPlayerName, shouldKick)
    task.delay(30, function() punishedPlayers[targetPlayerName] = nil end)
end

local function executeAntiTP(targetPlayerName)
    if not _G.antiTPEnabled or antiTPCooldowns[targetPlayerName] then return end
    antiTPCooldowns[targetPlayerName] = true
    
    local targetPlayer = nil
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Name == targetPlayerName then
            targetPlayer = player
            break
        end
    end
    if not targetPlayer then 
        antiTPCooldowns[targetPlayerName] = nil
        return 
    end
    
    -- Execute commands
    task.spawn(function()
        sendCommand("balloon", targetPlayer)
        task.wait(0.05)
        sendCommand("jail", targetPlayer)
    end)
    
    task.delay(5, function() antiTPCooldowns[targetPlayerName] = nil end)
end

local function stripTags(str)
    return string.gsub(str, "<.->", "")
end

-- Anti-TP System (simplified)
local function startAntiTP()
    task.spawn(function()
        task.wait(3)
        local myPlot = findMyPlot()
        if not myPlot then return end
        
        local detectedPlayers = {}
        while task.wait(0.1) do
            if not _G.antiTPEnabled then continue end
            
            local playersInPlot = getPlayersInMyPlot()
            for _, player in ipairs(playersInPlot) do
                if player.Character then
                    local hrp = player.Character:FindFirstChild("HumanoidRootPart")
                    if hrp and not detectedPlayers[player.Name] then
                        local myDecorations = myPlot:FindFirstChild("Decorations")
                        local myAnimals = myPlot:FindFirstChild("AnimalPodiums")
                        local tooClose = false
                        
                        if myDecorations and myDecorations:FindFirstChild("Model") then
                            local distance = (hrp.Position - myDecorations.Model:GetPivot().Position).Magnitude
                            if distance < 10 then
                                tooClose = true
                            end
                        end
                        
                        if myAnimals and not tooClose then
                            for _, animalPodium in ipairs(myAnimals:GetChildren()) do
                                local distance = (hrp.Position - animalPodium:GetPivot().Position).Magnitude
                                if distance < 7 then
                                    tooClose = true
                                    break
                                end
                                
                                for _, part in ipairs(animalPodium:GetDescendants()) do
                                    if part:IsA("BasePart") then
                                        part.CanTouch = true
                                        for _, touchingPart in ipairs(part:GetTouchingParts()) do
                                            if touchingPart.Parent == player.Character then
                                                tooClose = true
                                                break
                                            end
                                        end
                                        if tooClose then break end
                                    end
                                end
                                if tooClose then break end
                            end
                        end
                        
                        if tooClose then
                            detectedPlayers[player.Name] = true
                            executeAntiTP(player.Name)
                            task.delay(3, function() detectedPlayers[player.Name] = nil end)
                        end
                    end
                end
            end
        end
    end)
end

-- Base Defender (simplified)
local function startBaseDefender()
    local myPlot = findMyPlot()
    for i = 1, 10 do
        if myPlot then break end
        task.wait(1)
        myPlot = findMyPlot()
    end
    if not myPlot then return end
    
    task.spawn(function()
        if notificationRemote then

            notificationRemote.OnClientEvent:Connect(function(msg)

                
                if typeof(msg) ~= "string" or (not msg:find("Someone is stealing your") and not msg:find("Someone is robbing your")) then 

                    return 
                end
                

                
                task.spawn(function()
                    -- Execute immediately, no delays
                    local playersInPlot = getPlayersInMyPlot()

                    
                    if #playersInPlot == 0 then 

                        return 
                    end
                    
                    if #playersInPlot == 1 then
                        executeDefense(playersInPlot[1].Name, spamKickEnabled)
                        return
                    end
                    
                    local myDecorations = myPlot:FindFirstChild("Decorations")
                    local myAnimals = myPlot:FindFirstChild("AnimalPodiums")
                    local closestPlayer, closestDistance = nil, math.huge
                    
                    for _, player in ipairs(playersInPlot) do
                        if player.Character then
                            local hrp = player.Character:FindFirstChild("HumanoidRootPart")
                            if hrp then
                                local minDist = math.huge
                                if myDecorations and myDecorations:FindFirstChild("Model") then
                                    minDist = math.min(minDist, (hrp.Position - myDecorations.Model:GetPivot().Position).Magnitude)
                                end
                                if myAnimals then
                                    for _, animal in ipairs(myAnimals:GetChildren()) do
                                        minDist = math.min(minDist, (hrp.Position - animal:GetPivot().Position).Magnitude)
                                    end
                                end
                                if minDist < closestDistance then
                                    closestDistance = minDist
                                    closestPlayer = player
                                end
                            end
                        end
                    end
                    
                    executeDefense((closestPlayer or playersInPlot[1]).Name, spamKickEnabled)
                end)
            end)
        else
            -- GUI fallback method
            print("‚ö†Ô∏è Using GUI fallback for stealing detection (notification remote not available)")
            local playerGui = LocalPlayer:WaitForChild("PlayerGui")
            local trackedTexts = {}
            
            RunService.RenderStepped:Connect(function()
                if not spamKickEnabled and not spamNoKickEnabled then return end
                
                for _, gui in ipairs(playerGui:GetDescendants()) do
                    if (gui:IsA("TextLabel") or gui:IsA("TextButton")) and gui.Visible and gui.Text ~= "" then
                        local lowerText = string.lower(stripTags(gui.Text))
                        
                        if (string.find(lowerText, "stealing", 1, true) or string.find(lowerText, "robbing", 1, true)) and not trackedTexts[gui] then
                            trackedTexts[gui] = true
                            print("üì® GUI Detection: Found stealing text in GUI")
                            print("   Text: " .. gui.Text)
                            
                            task.spawn(function()
                                -- Execute immediately, no delays
                                local playersInPlot = getPlayersInMyPlot()
            
                                
                                if #playersInPlot > 0 then
                                    executeDefense(playersInPlot[1].Name, spamKickEnabled)
                                end
                            end)
                            
                            task.delay(5, function() trackedTexts[gui] = nil end)
                            break
                        end
                    end
                end
            end)
            
            print("‚úÖ GUI fallback stealing detection active")
        end
    end)
end

-- GUI - PREMIUM BLACK & WHITE ANIMATED
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BaseProtector"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Top Notification Bar - SLEEK
local notifBar = Instance.new("Frame")
notifBar.Name = "NotificationBar"
notifBar.Size = UDim2.new(0, 220, 0, 40)
notifBar.Position = UDim2.new(0.5, -110, 0, 10)
notifBar.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
notifBar.BackgroundTransparency = 0.6
notifBar.BorderSizePixel = 0
notifBar.Parent = screenGui

local notifCorner = Instance.new("UICorner")
notifCorner.CornerRadius = UDim.new(0, 12)
notifCorner.Parent = notifBar

-- Animated black/white gradient border
local notifStroke = Instance.new("UIStroke")
notifStroke.Thickness = 2
notifStroke.Transparency = 0.3
notifStroke.Parent = notifBar

local notifGradient = Instance.new("UIGradient")
notifGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(100, 100, 100)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255))
})
notifGradient.Parent = notifStroke

-- Smooth rotating gradient animation
task.spawn(function()
    while true do
        for i = 0, 360, 1 do
            notifGradient.Rotation = i
            task.wait(0.02)
        end
    end
end)

-- Title
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -10, 0, 18)
titleLabel.Position = UDim2.new(0, 8, 0, 2)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "‚öîÔ∏è Base Protector"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextSize = 12
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = notifBar

-- Ping & Player Count
local pingLabel = Instance.new("TextLabel")
pingLabel.Size = UDim2.new(0.5, -10, 0, 16)
pingLabel.Position = UDim2.new(0, 8, 0, 22)
pingLabel.BackgroundTransparency = 1
pingLabel.Text = "0ms (SAFE)"
pingLabel.TextColor3 = Color3.fromRGB(100, 255, 150)
pingLabel.TextSize = 9
pingLabel.Font = Enum.Font.GothamBold
pingLabel.TextXAlignment = Enum.TextXAlignment.Left
pingLabel.Parent = notifBar

local playerLabel = Instance.new("TextLabel")
playerLabel.Size = UDim2.new(0.5, -10, 0, 16)
playerLabel.Position = UDim2.new(0.5, 0, 0, 22)
playerLabel.BackgroundTransparency = 1
playerLabel.Text = "Players: 0"
playerLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
playerLabel.TextSize = 9
playerLabel.Font = Enum.Font.GothamBold
playerLabel.TextXAlignment = Enum.TextXAlignment.Left
playerLabel.Parent = notifBar

-- Control Panel - ULTRA SMOOTH
local controlPanel = Instance.new("Frame")
controlPanel.Name = "ControlPanel"
controlPanel.Size = UDim2.new(0, 170, 0, 150)
controlPanel.Position = UDim2.new(1, -180, 0, 60)
controlPanel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
controlPanel.BackgroundTransparency = 0.65
controlPanel.BorderSizePixel = 0
controlPanel.Active = true
controlPanel.Draggable = true
controlPanel.Parent = screenGui

local panelCorner = Instance.new("UICorner")
panelCorner.CornerRadius = UDim.new(0, 14)
panelCorner.Parent = controlPanel

-- Animated pulsing border
local panelStroke = Instance.new("UIStroke")
panelStroke.Color = Color3.fromRGB(255, 255, 255)
panelStroke.Thickness = 2
panelStroke.Transparency = 0.4
panelStroke.Parent = controlPanel

-- Add gradient to panel border
local panelGradient = Instance.new("UIGradient")
panelGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(150, 150, 150)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255))
})
panelGradient.Parent = panelStroke

-- Animate panel border rotation
task.spawn(function()
    while true do
        for i = 0, 360, 1 do
            panelGradient.Rotation = i
            task.wait(0.025)
        end
    end
end)

-- Pulsing animation
task.spawn(function()
    while true do
        TweenService:Create(panelStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
            Transparency = 0.2,
            Thickness = 2.5
        }):Play()
        task.wait(1.5)
        TweenService:Create(panelStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
            Transparency = 0.4,
            Thickness = 2
        }):Play()
        task.wait(1.5)
    end
end)

-- Title Bar
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 26)
titleBar.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
titleBar.BackgroundTransparency = 0.4
titleBar.BorderSizePixel = 0
titleBar.Parent = controlPanel

local titleBarCorner = Instance.new("UICorner")
titleBarCorner.CornerRadius = UDim.new(0, 14)
titleBarCorner.Parent = titleBar

local panelTitle = Instance.new("TextLabel")
panelTitle.Size = UDim2.new(1, -30, 0, 26)
panelTitle.Position = UDim2.new(0, 10, 0, 0)
panelTitle.BackgroundTransparency = 1
panelTitle.Text = "Base Defender"
panelTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
panelTitle.TextSize = 11
panelTitle.Font = Enum.Font.GothamBold
panelTitle.TextXAlignment = Enum.TextXAlignment.Left
panelTitle.Parent = titleBar

-- Minimize Button
local minimizeButton = Instance.new("TextButton")
minimizeButton.Size = UDim2.new(0, 20, 0, 20)
minimizeButton.Position = UDim2.new(1, -23, 0, 3)
minimizeButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
minimizeButton.BackgroundTransparency = 0.3
minimizeButton.Text = "‚îÄ"
minimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
minimizeButton.TextSize = 12
minimizeButton.Font = Enum.Font.GothamBold
minimizeButton.BorderSizePixel = 0
minimizeButton.Parent = titleBar

local minimizeCorner = Instance.new("UICorner")
minimizeCorner.CornerRadius = UDim.new(0, 6)
minimizeCorner.Parent = minimizeButton

local minimizeStroke = Instance.new("UIStroke")
minimizeStroke.Color = Color3.fromRGB(80, 80, 80)
minimizeStroke.Thickness = 1
minimizeStroke.Transparency = 0.5
minimizeStroke.Parent = minimizeButton

-- Hover effects
minimizeButton.MouseEnter:Connect(function()
    TweenService:Create(minimizeButton, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        TextColor3 = Color3.fromRGB(0, 0, 0),
        BackgroundTransparency = 0,
        Size = UDim2.new(0, 22, 0, 22)
    }):Play()
    TweenService:Create(minimizeStroke, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Transparency = 0
    }):Play()
end)

minimizeButton.MouseLeave:Connect(function()
    TweenService:Create(minimizeButton, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        BackgroundColor3 = Color3.fromRGB(30, 30, 30),
        TextColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 0.3,
        Size = UDim2.new(0, 20, 0, 20)
    }):Play()
    TweenService:Create(minimizeStroke, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Transparency = 0.5
    }):Play()
end)

-- Content Container
local contentContainer = Instance.new("Frame")
contentContainer.Size = UDim2.new(1, -10, 1, -31)
contentContainer.Position = UDim2.new(0, 5, 0, 28)
contentContainer.BackgroundTransparency = 1
contentContainer.Parent = controlPanel

-- Create toggle button function
local function createToggleButton(text, yPos, enabled)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 0, 36)
    button.Position = UDim2.new(0, 0, 0, yPos)
    button.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    button.BackgroundTransparency = 0.5
    button.BorderSizePixel = 0
    button.Text = ""
    button.AutoButtonColor = false
    button.ClipsDescendants = true
    button.Parent = contentContainer
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 9)
    btnCorner.Parent = button
    
    -- Animated gradient stroke
    local btnStroke = Instance.new("UIStroke")
    btnStroke.Color = enabled and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(60, 60, 60)
    btnStroke.Thickness = enabled and 2 or 1.5
    btnStroke.Transparency = enabled and 0.2 or 0.6
    btnStroke.Parent = button
    
    local btnGradient = Instance.new("UIGradient")
    btnGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, enabled and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(80, 80, 80)),
        ColorSequenceKeypoint.new(0.5, enabled and Color3.fromRGB(200, 200, 200) or Color3.fromRGB(50, 50, 50)),
        ColorSequenceKeypoint.new(1, enabled and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(80, 80, 80))
    })
    btnGradient.Parent = btnStroke
    
    -- Animate gradient when enabled
    if enabled then
        task.spawn(function()
            while button.Parent do
                if btnStroke.Transparency < 0.3 then
                    for i = 0, 360, 2 do
                        if not button.Parent then break end
                        btnGradient.Rotation = i
                        task.wait(0.02)
                    end
                else
                    task.wait(0.1)
                end
            end
        end)
    end
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -42, 1, 0)
    label.Position = UDim2.new(0, 6, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = enabled and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(140, 140, 140)
    label.TextSize = 8
    label.Font = Enum.Font.GothamBold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextWrapped = true
    label.Parent = button
    
    -- Modern toggle switch
    local switchBG = Instance.new("Frame")
    switchBG.Size = UDim2.new(0, 30, 0, 15)
    switchBG.Position = UDim2.new(1, -34, 0.5, -7.5)
    switchBG.BackgroundColor3 = enabled and Color3.fromRGB(220, 220, 220) or Color3.fromRGB(40, 40, 40)
    switchBG.BackgroundTransparency = 0.2
    switchBG.BorderSizePixel = 0
    switchBG.Parent = button
    
    local switchBGCorner = Instance.new("UICorner")
    switchBGCorner.CornerRadius = UDim.new(1, 0)
    switchBGCorner.Parent = switchBG
    
    local slider = Instance.new("Frame")
    slider.Size = UDim2.new(0, 11, 0, 11)
    slider.Position = enabled and UDim2.new(1, -13, 0.5, -5.5) or UDim2.new(0, 2, 0.5, -5.5)
    slider.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    slider.BorderSizePixel = 0
    slider.Parent = switchBG
    
    local sliderCorner = Instance.new("UICorner")
    sliderCorner.CornerRadius = UDim.new(1, 0)
    sliderCorner.Parent = slider
    
    -- Glow effect for slider when enabled
    if enabled then
        local sliderGlow = Instance.new("UIStroke")
        sliderGlow.Color = Color3.fromRGB(255, 255, 255)
        sliderGlow.Thickness = 1.5
        sliderGlow.Transparency = 0.5
        sliderGlow.Parent = slider
        
        task.spawn(function()
            while slider.Parent do
                if btnStroke.Transparency < 0.3 then
                    TweenService:Create(sliderGlow, TweenInfo.new(0.8, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {Transparency = 0.2}):Play()
                    task.wait(0.8)
                    TweenService:Create(sliderGlow, TweenInfo.new(0.8, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {Transparency = 0.6}):Play()
                    task.wait(0.8)
                else
                    task.wait(0.1)
                end
            end
        end)
    end
    
    -- Hover effect
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            BackgroundTransparency = 0.3,
            Size = UDim2.new(1, 2, 0, 38)
        }):Play()
    end)
    
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            BackgroundTransparency = 0.5,
            Size = UDim2.new(1, 0, 0, 36)
        }):Play()
    end)
    
    return button, btnStroke, switchBG, slider, label, btnGradient
end

-- Create buttons
local spamKickButton, spamKickStroke, spamKickBG, spamKickSlider, spamKickLabel, spamKickGradient = createToggleButton("SPAM IF STEALING (KICK)", 0, spamKickEnabled)
local spamNoKickButton, spamNoKickStroke, spamNoKickBG, spamNoKickSlider, spamNoKickLabel, spamNoKickGradient = createToggleButton("SPAM IF STEALING (NO KICK)", 40, spamNoKickEnabled)
local antiTPButton, antiTPStroke, antiTPBG, antiTPSlider, antiTPLabel, antiTPGradient = createToggleButton("ANTI-TP SCAM", 80, antiTPEnabled)

-- Ping update loop
task.spawn(function()
    while true do
        task.wait(0.5)
        local success, ping = pcall(function()
            return math.floor(Stats.Network.ServerStatsItem["Data Ping"]:GetValue())
        end)
        
        if success and ping then
            local status, color
            if ping < 80 then
                status, color = "(SAFE)", Color3.fromRGB(100, 255, 150)
            elseif ping < 120 then
                status, color = "(SAFE)", Color3.fromRGB(255, 220, 100)
            elseif ping < 150 then
                status, color = "(RISKY)", Color3.fromRGB(255, 180, 100)
            else
                status, color = "(NOT SAFE)", Color3.fromRGB(255, 100, 100)
            end
            pingLabel.Text = ping .. "ms " .. status
            pingLabel.TextColor3 = color
        else
            pingLabel.Text = "0ms (SAFE)"
            pingLabel.TextColor3 = Color3.fromRGB(100, 255, 150)
        end
        
        playerLabel.Text = "Players: " .. #Players:GetPlayers()
    end
end)

-- Minimize animation - ULTRA SMOOTH
local isMinimized = false
local originalSize = controlPanel.Size

minimizeButton.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    
    if isMinimized then
        -- Collapse
        TweenService:Create(panelStroke, TweenInfo.new(0.3, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
            Thickness = 1.5,
            Transparency = 0.6
        }):Play()
        
        for _, child in ipairs(contentContainer:GetChildren()) do
            if child:IsA("TextButton") then
                TweenService:Create(child, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 0, 0)
                }):Play()
            end
        end
        
        task.wait(0.15)
        contentContainer.Visible = false
        
        TweenService:Create(controlPanel, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
            Size = UDim2.new(0, 170, 0, 26)
        }):Play()
        
        minimizeButton.Text = "‚ñ°"
        
    else
        -- Expand
        TweenService:Create(panelStroke, TweenInfo.new(0.3, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
            Thickness = 3,
            Transparency = 0.1
        }):Play()
        
        TweenService:Create(controlPanel, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Size = originalSize
        }):Play()
        
        minimizeButton.Text = "‚îÄ"
        
        task.wait(0.35)
        
        contentContainer.Visible = true
        for i, child in ipairs(contentContainer:GetChildren()) do
            if child:IsA("TextButton") then
                child.Size = UDim2.new(1, 0, 0, 0)
                child.BackgroundTransparency = 1
                
                TweenService:Create(child, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                    Size = UDim2.new(1, 0, 0, 36),
                    BackgroundTransparency = 0.5
                }):Play()
            end
        end
        
        task.wait(0.3)
        TweenService:Create(panelStroke, TweenInfo.new(0.3, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
            Thickness = 2,
            Transparency = 0.4
        }):Play()
    end
end)

-- Toggle function helper
local function createToggleHandler(button, stroke, switchBG, slider, label, gradient, settingVar, settingName)
    button.MouseButton1Click:Connect(function()
        _G[settingName] = not _G[settingName]
        local enabled = _G[settingName]
        
        -- Update the actual variables used in the code
        if settingName == "spamKickEnabled" then
            spamKickEnabled = enabled
        elseif settingName == "spamNoKickEnabled" then
            spamNoKickEnabled = enabled
        elseif settingName == "antiTPEnabled" then
            antiTPEnabled = enabled
        end
        
        local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
        
        TweenService:Create(stroke, tweenInfo, {
            Color = enabled and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(60, 60, 60),
            Thickness = enabled and 2 or 1.5,
            Transparency = enabled and 0.2 or 0.6
        }):Play()
        
        TweenService:Create(switchBG, tweenInfo, {
            BackgroundColor3 = enabled and Color3.fromRGB(220, 220, 220) or Color3.fromRGB(40, 40, 40)
        }):Play()
        
        TweenService:Create(slider, tweenInfo, {
            Position = enabled and UDim2.new(1, -13, 0.5, -5.5) or UDim2.new(0, 2, 0.5, -5.5)
        }):Play()
        
        TweenService:Create(label, tweenInfo, {
            TextColor3 = enabled and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(140, 140, 140)
        }):Play()
        
        gradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, enabled and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(80, 80, 80)),
            ColorSequenceKeypoint.new(0.5, enabled and Color3.fromRGB(200, 200, 200) or Color3.fromRGB(50, 50, 50)),
            ColorSequenceKeypoint.new(1, enabled and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(80, 80, 80))
        })
    end)
end

_G.spamKickEnabled = spamKickEnabled
_G.spamNoKickEnabled = spamNoKickEnabled
_G.antiTPEnabled = antiTPEnabled

createToggleHandler(spamKickButton, spamKickStroke, spamKickBG, spamKickSlider, spamKickLabel, spamKickGradient, spamKickEnabled, "spamKickEnabled")
createToggleHandler(spamNoKickButton, spamNoKickStroke, spamNoKickBG, spamNoKickSlider, spamNoKickLabel, spamNoKickGradient, spamNoKickEnabled, "spamNoKickEnabled")
createToggleHandler(antiTPButton, antiTPStroke, antiTPBG, antiTPSlider, antiTPLabel, antiTPGradient, antiTPEnabled, "antiTPEnabled")

-- Wait for admin remote to be ready before starting systems
task.spawn(function()
    print("‚è≥ Waiting for admin remote to be ready...")
    
    -- Wait up to 15 seconds for remote
    local maxWait = 15
    local waited = 0
    while not adminRemote and waited < maxWait do
        task.wait(0.5)
        waited = waited + 0.5
    end
    
    if adminRemote then
        print("‚úÖ Admin remote ready! Starting protection systems...")
        startBaseDefender()
        startAntiTP()
        print("‚úÖ Base Protector V3 fully loaded!")
    else
        warn("‚ùå Failed to start - admin remote not found after " .. maxWait .. " seconds")
    end
end)
